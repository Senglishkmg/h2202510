<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>에스 독해법 연습</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .diff-correct { background-color: #dcfce7; border-radius: 0.25rem; padding: 0 0.2rem; border-bottom: 2px solid #22c55e; }
        .diff-incorrect { background-color: #fee2e2; border-radius: 0.25rem; padding: 0 0.2rem; text-decoration: line-through; text-decoration-color: #ef4444; }
        @media print {
            body * { visibility: hidden; }
            #result-container, #result-container * { visibility: visible; }
            #result-container { position: absolute; left: 0; top: 0; width: 100%; }
            .no-print { display: none; }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
<div class="bg-white w-full max-w-4xl rounded-xl shadow-lg p-6 md:p-8 transition-all duration-500">
    <div id="problem-container"></div>
    <div id="result-container" class="hidden mt-8">
         <div class="border-b pb-3 mb-6"><h2 class="text-2xl font-bold text-gray-800">채점 결과</h2><p class="text-gray-500">입력한 답안과 정답을 비교한 결과입니다.</p></div>
        <div id="result-items" class="space-y-6"></div>
        <div id="result-buttons" class="flex flex-col md:flex-row gap-3 mt-8 no-print">
            <button onclick="saveAsPdf()" class="w-full md:w-1/2 bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>PDF로 저장하기</button>
             <button onclick="resetQuiz()" class="w-full md:w-1/2 bg-gray-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-700 transition-colors flex items-center justify-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>다시 풀기</button>
        </div>
    </div>
</div>
<script>
    const { jsPDF } = window.jspdf;
    const quizData = {
  "pageId": "h2251030st-full",
  "instruction": "다음 문장을 에스독해법으로 해석하시오.",
  "sentences": [
    {
      "sentence": "Within liberal culture, the value of fair equality of opportunity for individuals outweighs the preservation of the family’s integrity.",
      "correctAnswer": "자유주의 문화 내에서, / 가치는 [개인을 위한 공정한 기회 평등의] / 더 중요하다 / 보존보다 [가족의 온전함의]."
    },
    {
      "sentence": "In contrast, for Confucian culture, while seeking fair equality of opportunity for individuals is important, the family assumes a fundamental role in human flourishing, and living within a family institution is considered the essential way of life.",
      "correctAnswer": "대조적으로, / 유교 문화에서는, / 추구하는 것이 [개인을 위한 공정한 기회 평등을] 중요하지만, / 가족은 / 맡는다 / 근본적인 역할을 / 인간의 번영에서, / 그리고 가족 제도 내에서 사는 것은 / 여겨진다 / 필수적인 삶의 방식으로."
    },
    {
      "sentence": "Individuals are primarily understood as family members before they are regarded as state citizens.",
      "correctAnswer": "개인들은 / 주로 이해된다 / 가족 구성원으로서 / 그들이 여겨지기 전에 / 국가의 시민으로서."
    },
    {
      "sentence": "Therefore, for Confucians, the family possesses inherent value that should never be abandoned, even if it results in certain societal inequalities.",
      "correctAnswer": "따라서, / 유교주의자들에게는, / 가족은 / 지닌다 / 내재적 가치를 / [결코 버려져서는 안 되는], / 비록 그것이 초래할지라도 / 특정 사회적 불평등을."
    },
    {
      "sentence": "Some cultures, like the liberal one, may choose to impose increasing restrictions on the role of families and implement more egalitarian government programs for education, healthcare, and other positive rights in society in the pursuit of fair equality of opportunity.",
      "correctAnswer": "일부 문화는, / 자유주의 문화와 같은, / 선택할지도 모른다 / 부과하기를 / 증가하는 제약을 / 가족의 역할에 / 그리고 시행하기를 / 더 평등주의적인 정부 프로그램을 / 교육, 의료, 그리고 다른 적극적 권리를 위한 / 사회에서 / 추구하여 / 공정한 기회 평등을."
    },
    {
      "sentence": "On the other hand, other cultures, like the Confucian one, may prefer to primarily assign welfare responsibilities to the family, accepting inequalities stemming from the existence of the family as long as everyone’s basic freedoms and rights are safeguarded in the state.",
      "correctAnswer": "반면에, / 다른 문화는, / 유교 문화와 같은, / 선호할지도 모른다 / 주로 할당하기를 / 복지 책임을 / 가족에게, / 받아들이면서 / 불평등을 / [가족의 존재로부터 비롯되는] / 모든 사람의 기본적 자유와 권리가 / 보호되는 한 / 국가에서."
    }
  ]
};
    const problemContainer = document.getElementById('problem-container');
    const resultContainer = document.getElementById('result-container');
    let currentSentenceIndex = 0;
    let studentAnswers = [];

    function renderProblem() {
        const currentProblem = quizData.sentences[currentSentenceIndex];
        const isLastProblem = currentSentenceIndex === quizData.sentences.length - 1;
        const buttonText = isLastProblem ? "제출하고 채점하기" : "다음 문장";
        problemContainer.innerHTML = `
            <div class="flex justify-between items-center mb-4"><h1 class="text-2xl font-bold text-gray-800">${quizData.instruction}</h1><span class="text-sm font-medium text-gray-500 bg-gray-100 px-3 py-1 rounded-full">${currentSentenceIndex + 1} / ${quizData.sentences.length}</span></div>
            <p class="bg-gray-100 p-4 rounded-lg text-gray-700 my-4 leading-relaxed">${currentProblem.sentence}</p>
            <textarea id="student-input" class="w-full h-32 p-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="이곳에 에스독해법 해석을 입력하세요..."></textarea>
            <button onclick="submitAnswer()" class="w-full mt-4 bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors">${buttonText}</button>
        `;
        document.getElementById('student-input').focus();
    }
    
    function submitAnswer() {
        const studentAnswer = document.getElementById('student-input').value;
        studentAnswers.push(studentAnswer);
        currentSentenceIndex++;
        if (currentSentenceIndex < quizData.sentences.length) { renderProblem(); } else { showFinalResults(); }
    }

    function showFinalResults() {
        problemContainer.classList.add('hidden');
        resultContainer.classList.remove('hidden');
        const resultItemsContainer = document.getElementById('result-items');
        resultItemsContainer.innerHTML = '';
        quizData.sentences.forEach((problem, index) => {
            const { studentHtml, correctHtml } = createDiffHtml(studentAnswers[index], problem.correctAnswer);
            resultItemsContainer.innerHTML += `
                <div class="border p-4 rounded-lg">
                    <p class="text-sm font-semibold text-gray-500 mb-2">문장 ${index + 1}</p>
                    <p class="mb-3 text-gray-800">${problem.sentence}</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-gray-50 p-3 rounded-md"><h4 class="font-semibold text-gray-700 mb-2">나의 답안</h4><p class="whitespace-pre-wrap leading-relaxed">${studentHtml || '(입력 안 함)'}</p></div>
                        <div class="bg-gray-50 p-3 rounded-md"><h4 class="font-semibold text-gray-700 mb-2">정답</h4><p class="whitespace-pre-wrap leading-relaxed">${correctHtml}</p></div>
                    </div>
                </div>`;
        });
    }

    function resetQuiz() {
        currentSentenceIndex = 0;
        studentAnswers = [];
        resultContainer.classList.add('hidden');
        problemContainer.classList.remove('hidden');
        renderProblem();
    }
    
    function saveAsPdf() {
        const resultElement = document.getElementById('result-container');
        const originalTitle = document.title;
        document.title = 'h2251030st_results';
        document.getElementById('result-buttons').classList.add('no-print');
        html2canvas(resultElement).then(canvas => {
            const imgData = canvas.toDataURL('image/png');
            const pdf = new jsPDF('p', 'mm', 'a4');
            const imgProps = pdf.getImageProperties(imgData);
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
            pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
            pdf.save(`${document.title}.pdf`);
            document.getElementById('result-buttons').classList.remove('no-print');
            document.title = originalTitle;
        });
    }

    function createDiffHtml(studentText, correctText) {
        const studentWords = studentText.split(/(\s+|[/])/);
        const correctWords = correctText.split(/(\s+|[/])/);
        let studentHtml = '', correctHtml = '';
        const maxLength = Math.max(studentWords.length, correctWords.length);
        for (let i = 0; i < maxLength; i++) {
            const studentWord = studentWords[i] || '';
            const correctWord = correctWords[i] || '';
            if (studentWord === correctWord) {
                studentHtml += `<span>${escapeHtml(studentWord)}</span>`;
                correctHtml += `<span>${escapeHtml(correctWord)}</span>`;
            } else {
                if (studentWord) studentHtml += `<span class="diff-incorrect">${escapeHtml(studentWord)}</span>`;
                if (correctWord) correctHtml += `<span class="diff-correct">${escapeHtml(correctWord)}</span>`;
            }
        }
        return { studentHtml, correctHtml };
    }

    function escapeHtml(text) {
        return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
    }

    document.addEventListener('DOMContentLoaded', renderProblem);
</script>
</body>
</html>