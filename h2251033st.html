<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>에스 독해법 연습</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .diff-correct { background-color: #dcfce7; border-radius: 0.25rem; padding: 0 0.2rem; border-bottom: 2px solid #22c55e; }
        .diff-incorrect { background-color: #fee2e2; border-radius: 0.25rem; padding: 0 0.2rem; text-decoration: line-through; text-decoration-color: #ef4444; }
        @media print {
            body * { visibility: hidden; }
            #result-container, #result-container * { visibility: visible; }
            #result-container { position: absolute; left: 0; top: 0; width: 100%; }
            .no-print { display: none; }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
<div class="bg-white w-full max-w-4xl rounded-xl shadow-lg p-6 md:p-8 transition-all duration-500">
    <div id="problem-container"></div>
    <div id="result-container" class="hidden mt-8">
         <div class="border-b pb-3 mb-6"><h2 class="text-2xl font-bold text-gray-800">채점 결과</h2><p class="text-gray-500">입력한 답안과 정답을 비교한 결과입니다.</p></div>
        <div id="result-items" class="space-y-6"></div>
        <div id="result-buttons" class="flex flex-col md:flex-row gap-3 mt-8 no-print">
            <button onclick="saveAsPdf()" class="w-full md:w-1/2 bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>PDF로 저장하기</button>
             <button onclick="resetQuiz()" class="w-full md:w-1/2 bg-gray-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-700 transition-colors flex items-center justify-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>다시 풀기</button>
        </div>
    </div>
</div>
<script>
    const { jsPDF } = window.jspdf;
    const quizData = {
  "pageId": "h2251033st-full",
  "instruction": "다음 문장을 에스독해법으로 해석하시오.",
  "sentences": [
    {
      "sentence": "Historically, palaces weren’t just homes; they were carefully constructed stages designed to impress and intimidate.",
      "correctAnswer": "역사적으로, / 궁전은 / 단지 집이 아니었다; / 그것들은 / 세심하게 건설된 무대였다 / [설계된 / 깊은 인상을 주고 위압감을 주기 위해]."
    },
    {
      "sentence": "While stone symbolized permanence and strength, glass offered something equally powerful: visibility.",
      "correctAnswer": "돌이 상징했던 반면 / 영속성과 힘을, / 유리는 / 제공했다 / 똑같이 강력한 무언가를: / (즉) 가시성을."
    },
    {
      "sentence": "The introduction of large windows in palaces allowed rulers to literally look down upon their subjects, emphasizing their elevated position.",
      "correctAnswer": "도입은 [궁전의 큰 창문의] / 허용했다 / 통치자들이 / 말 그대로 내려다보도록 / 그들의 신하들을, / 강조하면서 / 그들의 높은 지위를."
    },
    {
      "sentence": "Conversely, it also allowed subjects to gaze up at their leaders, creating a sense of awe and distance.",
      "correctAnswer": "반대로, / 그것은 / 또한 허용했다 / 신하들이 / 올려다보도록 / 그들의 지도자를, / 만들어내면서 / 경외감과 거리감을."
    },
    {
      "sentence": "Consider the Palace of Versailles: its Hall of Mirrors, lined with reflective surfaces, not only magnified the grandeur of the space but also placed the king at the center of a dazzling display, reinforcing his absolute authority.",
      "correctAnswer": "생각해 보라 / 베르사유 궁전을: / 그곳의 거울의 방은, / [반사 표면으로 늘어선], / 확대했을 뿐만 아니라 / 공간의 웅장함을 / 오히려 또한 놓았다 / 왕을 / 눈부신 광경의 중심에, / 강화하면서 / 그의 절대적인 권위를."
    },
    {
      "sentence": "The use of glass in palaces wasn’t merely aesthetic; it was strategic.",
      "correctAnswer": "사용은 [궁전에서의 유리의] / 단지 미적인 것이 아니었다; / 그것은 / 전략적이었다."
    },
    {
      "sentence": "Open sightlines allowed for better surveillance and control, ensuring the safety and security of the ruling family.",
      "correctAnswer": "개방된 시야는 / 가능하게 했다 / 더 나은 감시와 통제를, / 보장하면서 / 지배 가문의 안전과 보안을."
    },
    {
      "sentence": "Courtiers and visitors were constantly aware of being observed, contributing to an atmosphere of careful obedience and respect.",
      "correctAnswer": "신하들과 방문객들은 / 끊임없이 인지했다 / 관찰되고 있다는 것을, / 기여하면서 / 신중한 복종과 존중의 분위기에."
    },
    {
      "sentence": "The very architecture dictated social behavior, with glass acting as a silent enforcer of the power dynamic.",
      "correctAnswer": "바로 그 건축 양식이 / 지시했다 / 사회적 행동을, / 유리가 조용한 집행자 역할을 하면서 / [권력 역학의]."
    }
  ]
};
    const problemContainer = document.getElementById('problem-container');
    const resultContainer = document.getElementById('result-container');
    let currentSentenceIndex = 0;
    let studentAnswers = [];

    function renderProblem() {
        const currentProblem = quizData.sentences[currentSentenceIndex];
        const isLastProblem = currentSentenceIndex === quizData.sentences.length - 1;
        const buttonText = isLastProblem ? "제출하고 채점하기" : "다음 문장";
        problemContainer.innerHTML = `
            <div class="flex justify-between items-center mb-4"><h1 class="text-2xl font-bold text-gray-800">${quizData.instruction}</h1><span class="text-sm font-medium text-gray-500 bg-gray-100 px-3 py-1 rounded-full">${currentSentenceIndex + 1} / ${quizData.sentences.length}</span></div>
            <p class="bg-gray-100 p-4 rounded-lg text-gray-700 my-4 leading-relaxed">${currentProblem.sentence}</p>
            <textarea id="student-input" class="w-full h-32 p-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="이곳에 에스독해법 해석을 입력하세요..."></textarea>
            <button onclick="submitAnswer()" class="w-full mt-4 bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors">${buttonText}</button>
        `;
        document.getElementById('student-input').focus();
    }
    
    function submitAnswer() {
        const studentAnswer = document.getElementById('student-input').value;
        studentAnswers.push(studentAnswer);
        currentSentenceIndex++;
        if (currentSentenceIndex < quizData.sentences.length) { renderProblem(); } else { showFinalResults(); }
    }

    function showFinalResults() {
        problemContainer.classList.add('hidden');
        resultContainer.classList.remove('hidden');
        const resultItemsContainer = document.getElementById('result-items');
        resultItemsContainer.innerHTML = '';
        quizData.sentences.forEach((problem, index) => {
            const { studentHtml, correctHtml } = createDiffHtml(studentAnswers[index], problem.correctAnswer);
            resultItemsContainer.innerHTML += `
                <div class="border p-4 rounded-lg">
                    <p class="text-sm font-semibold text-gray-500 mb-2">문장 ${index + 1}</p>
                    <p class="mb-3 text-gray-800">${problem.sentence}</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-gray-50 p-3 rounded-md"><h4 class="font-semibold text-gray-700 mb-2">나의 답안</h4><p class="whitespace-pre-wrap leading-relaxed">${studentHtml || '(입력 안 함)'}</p></div>
                        <div class="bg-gray-50 p-3 rounded-md"><h4 class="font-semibold text-gray-700 mb-2">정답</h4><p class="whitespace-pre-wrap leading-relaxed">${correctHtml}</p></div>
                    </div>
                </div>`;
        });
    }

    function resetQuiz() {
        currentSentenceIndex = 0;
        studentAnswers = [];
        resultContainer.classList.add('hidden');
        problemContainer.classList.remove('hidden');
        renderProblem();
    }
    
    function saveAsPdf() {
        const resultElement = document.getElementById('result-container');
        const originalTitle = document.title;
        document.title = 'h2251033st_results';
        document.getElementById('result-buttons').classList.add('no-print');
        html2canvas(resultElement).then(canvas => {
            const imgData = canvas.toDataURL('image/png');
            const pdf = new jsPDF('p', 'mm', 'a4');
            const imgProps = pdf.getImageProperties(imgData);
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
            pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
            pdf.save(`${document.title}.pdf`);
            document.getElementById('result-buttons').classList.remove('no-print');
            document.title = originalTitle;
        });
    }

    function createDiffHtml(studentText, correctText) {
        const studentWords = studentText.split(/(\s+|[/])/);
        const correctWords = correctText.split(/(\s+|[/])/);
        let studentHtml = '', correctHtml = '';
        const maxLength = Math.max(studentWords.length, correctWords.length);
        for (let i = 0; i < maxLength; i++) {
            const studentWord = studentWords[i] || '';
            const correctWord = correctWords[i] || '';
            if (studentWord === correctWord) {
                studentHtml += `<span>${escapeHtml(studentWord)}</span>`;
                correctHtml += `<span>${escapeHtml(correctWord)}</span>`;
            } else {
                if (studentWord) studentHtml += `<span class="diff-incorrect">${escapeHtml(studentWord)}</span>`;
                if (correctWord) correctHtml += `<span class="diff-correct">${escapeHtml(correctWord)}</span>`;
            }
        }
        return { studentHtml, correctHtml };
    }

    function escapeHtml(text) {
        return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
    }

    document.addEventListener('DOMContentLoaded', renderProblem);
</script>
</body>
</html>